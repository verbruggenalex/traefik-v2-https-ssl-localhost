version: '3'

services:
  traefik:
    image: traefik:v2.3
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "https://traefik.docker.localhost/dashboard/#/"]
      interval: 2s
      timeout: 10s
      retries: 5
      start_period: 5s
    security_opt:
      - no-new-privileges:true
    ports:
      - 80:80
      - 443:443
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./traefik/traefik.yml:/etc/traefik/traefik.yml:ro
      - ./traefik/config.yml:/etc/traefik/config.yml:ro
      - ./certs:/etc/certs:ro
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.traefik=true"

  # web:
  #   image: verbral/php-theia:7.4
  #   working_dir: ${PWD}
  #   environment:
  #     WAKATIME_API_KEY:
  #     GIT_USER_NAME:
  #     GIT_USER_EMAIL:
  #   volumes:
  #     - ${PWD}:${PWD}
  #     - ~/.ssh:/home/docker/.ssh
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.traefik-ide.rule=Host(`traefik.docker.localhost`) && PathPrefix(`/ide`)"
  #     - "traefik.http.routers.traefik-ide.service=traefik-ide"
  #     - "traefik.http.routers.traefik-ide.middlewares=ide-stripprefix"
  #     - "traefik.http.middlewares.ide-stripprefix.stripprefix.prefixes=/ide"
  #     - "traefik.http.routers.traefik-ide.tls=true"
  #     - "traefik.http.services.traefik-ide.loadbalancer.server.port=3000"
  #   networks:
  #     - proxy

networks:
  proxy:
    external: true
